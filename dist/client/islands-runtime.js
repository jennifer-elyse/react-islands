"use client";import m from"react";import{hydrateRoot as h,createRoot as v}from"react-dom/client";var w=()=>{},b=async e=>{if(!window.crypto?.subtle||typeof TextEncoder>"u")return null;let t=new TextEncoder().encode(e),s=await window.crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s),o="";for(let a of n)o+=String.fromCharCode(a);return`sha256-${btoa(o)}`},_=async({elId:e="islands-manifest",integrityAttr:t="data-integrity",reportEvent:s})=>{let n=document.getElementById(e);if(!n)return{modules:{}};let o=n.textContent||"{}",a=n.getAttribute(t);if(a)try{let r=await b(o);r&&r!==a&&s({event:"manifest_integrity_failed",detail:{expectedIntegrity:a,actualIntegrity:r}})}catch(r){s({event:"manifest_integrity_error",detail:{message:r?.message||String(r)}})}try{let r=JSON.parse(o);return r.modules||(r.modules={}),r}catch{return{modules:{}}}},I=e=>{let t=!1;return(...s)=>{t||(t=!0,e(...s))}},p=e=>{if("requestIdleCallback"in window){window.requestIdleCallback(e,{timeout:2e3});return}setTimeout(e,250)},S=(e,t)=>{if(!("IntersectionObserver"in window)){t();return}let s=new IntersectionObserver(n=>{for(let o of n)if(o.isIntersecting){s.disconnect(),t();return}});s.observe(e)},k=(e,t)=>{let s=I(t),n=()=>{e.removeEventListener("click",n,!0),e.removeEventListener("focus",n,!0),e.removeEventListener("keydown",n,!0),s()};e.addEventListener("click",n,!0),e.addEventListener("focus",n,!0),e.addEventListener("keydown",n,!0)},L=async({el:e,moduleSpecifier:t,props:s,manifest:n,reportEvent:o})=>{let a=n.modules[t];if(!a){o({event:"island_module_missing",detail:{moduleSpecifier:t}});return}let r;try{r=await import(a)}catch(d){o({event:"island_import_failed",detail:{moduleSpecifier:t,resolved:a,message:d?.message||String(d)}});return}let i=r.default;if(!i&&typeof r.mount=="function"){try{r.mount(e,s)}catch(d){o({event:"island_mount_failed",detail:{moduleSpecifier:t,resolved:a,message:d?.message||String(d),mode:"mount-fallback"}})}return}if(!i){o({event:"island_default_export_missing",detail:{moduleSpecifier:t,resolved:a}});return}let c=e.childNodes&&e.childNodes.length>0;try{c?h(e,m.createElement(i,s)):v(e).render(m.createElement(i,s))}catch(d){o({event:"island_mount_failed",detail:{moduleSpecifier:t,resolved:a,message:d?.message||String(d)}})}},y=async({manifestElId:e="islands-manifest",selector:t="[data-island-module]",onError:s,reportEvent:n}={})=>{let o=typeof n=="function"?n:w,a=await _({elId:e,reportEvent:o}),r=document.querySelectorAll(t);r.length||o({event:"islands_not_found"});for(let i of r){let c=i.getAttribute("data-island-module"),d=i.getAttribute("data-hydrate")||"visible",g=i.getAttribute("data-props")||"null",u=null;try{u=JSON.parse(g)}catch{u=null}let l=()=>{try{return L({el:i,moduleSpecifier:c,props:u,manifest:a,reportEvent:o})}catch(f){s?s(f,i,c):console.error("Failed to hydrate island",c,f)}};d==="immediate"?l():d==="idle"?p(l):d==="interaction"?k(i,l):S(i,l)}};typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{y()}):y());export{y as bootIslands};
