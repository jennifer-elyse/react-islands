#!/usr/bin/env node
import a from"node:fs";import u from"node:path";var d=t=>JSON.parse(a.readFileSync(t,"utf8")),m=t=>{if(t.startsWith("src/client/islands/")&&t.includes(".entry.")){let s=t.replace(/^src\/client\/islands\//,"").replace(/\.entry\.(js|jsx)$/,""),n=t.endsWith(".js")?".js":".jsx";return`/src/client/islands/${s}.entry${n}`}return null},p=({viteManifestPath:t,outPath:s})=>{if(!a.existsSync(t))throw new Error(`Vite manifest not found: ${t}`);let n=d(t),o={};for(let[e,c]of Object.entries(n)){let f=m(e);f&&(o[f]=`/${c.file}`)}let i=null,r=null;for(let[e,c]of Object.entries(n))e==="src/client/islands-runtime.entry.js"&&(i=`/${c.file}`),e==="src/client/pwa-toast.entry.js"&&(r=`/${c.file}`);if(!i)throw new Error("Could not find runtime entry src/client/islands-runtime.entry.js in Vite manifest");let l={modules:o,"islands-runtime":i,"pwa-toast":r};return a.writeFileSync(s,JSON.stringify(l,null,"	"),"utf8"),l},j=()=>{let t=process.argv.slice(2),s=l=>{let e=t.indexOf(l);return e===-1?null:t[e+1]},n=s("--in"),o=s("--out")||"dist/client/islands-manifest.json";if(!n)throw new Error("Usage: react-islands-gen-manifest --in dist/client/.vite/manifest.json [--out dist/client/islands-manifest.json]");let i=u.resolve(n),r=u.resolve(o);p({viteManifestPath:i,outPath:r}),console.log(`Wrote ${r}`)};import.meta.url===`file://${process.argv[1]}`&&j();export{p as buildIslandsManifest,j as runCli};
