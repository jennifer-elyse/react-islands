import{j as t}from"../jsx-runtime-D_zvdyIk.js";import{r}from"../index-DYrVU9rO.js";import{c as G}from"../client-CKv3Qlnq.js";const S={form:{width:"100%"},wrapper:{display:"flex",alignItems:"center",gap:8,border:"1px solid #ddd",borderRadius:8,padding:6,background:"#fff"},input:{flex:1,border:"none",outline:"none",padding:"8px 10px",fontSize:16,background:"transparent"},button:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:44,height:44,borderRadius:6,border:"1px solid #0b5",background:"#0b5",color:"#fff",cursor:"pointer"}},X=({placeholder:g,value:u="",onChange:m,onKeyDown:h,onFocus:v,onSubmit:j,inputRef:N,showSpinner:R=!1,ariaExpanded:b=!1,children:k})=>{const i=typeof m=="function";return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"search-island__root",style:S.form,children:[t.jsx("form",{onSubmit:j,className:"search-island",role:"search",children:t.jsxs("div",{className:"search-island__input-wrapper",style:S.wrapper,children:[t.jsx("input",{ref:N,type:"search",value:i?u:void 0,defaultValue:i?void 0:u,onChange:m,onKeyDown:h,onFocus:v,placeholder:g,className:"search-island__input",autoComplete:"off","aria-label":"Search products","aria-expanded":b,style:S.input}),R&&t.jsx("span",{className:"search-island__spinner"}),t.jsx("button",{type:"submit",className:"search-island__btn",style:S.button,children:t.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("circle",{cx:"11",cy:"11",r:"8"}),t.jsx("path",{d:"m21 21-4.35-4.35"})]})})]})}),t.jsx("div",{className:"search-island__dropdown-shell",suppressHydrationWarning:!0,children:k||null})]}),t.jsx("style",{children:`
				.search-island__root { position: relative; width: 100%; }
				.search-island__input-wrapper { display: flex; align-items: center; background: #fff; border: 1px solid #dee2e6; border-radius: 8px; transition: border-color 0.2s, box-shadow 0.2s; }
				.search-island__input-wrapper:focus-within { border-color: #2d6a4f; box-shadow: 0 0 0 3px rgba(45,106,79,0.15); }
				.search-island__input { flex: 1; padding: 10px 16px; border: none; background: transparent; font-size: 1rem; outline: none; }
				.search-island__spinner { width: 18px; height: 18px; border: 2px solid #dee2e6; border-top-color: #2d6a4f; border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 8px; }
				@keyframes spin { to { transform: rotate(360deg); } }
				.search-island__btn { display: flex; align-items: center; justify-content: center; padding: 10px 14px; background: #2d6a4f; color: white; border: none; border-radius: 0 7px 7px 0; cursor: pointer; }
				.search-island__btn svg { width: 22px; height: 22px; }
				.search-island__btn:hover { background: #1b4332; }
				.search-island__dropdown { position: absolute; top: calc(100% + 4px); left: 0; right: 0; background: white; border: 1px solid #dee2e6; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-height: 420px; overflow-y: auto; z-index: 1000; }
				.search-island__tabs { display: flex; border-bottom: 1px solid #dee2e6; }
				.search-island__tab { flex: 1; padding: 10px; background: none; border: none; font-size: 0.875rem; color: #6c757d; cursor: pointer; }
				.search-island__tab:hover { background: #f8f9fa; }
				.search-island__tab--active { color: #2d6a4f; font-weight: 600; box-shadow: inset 0 -2px 0 #2d6a4f; }
				.search-island__list { list-style: none; padding: 0; margin: 0; }
				.search-island__item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; cursor: pointer; }
				.search-island__item:hover, .search-island__item--selected { background: #f8f9fa; }
				.search-island__item-img { width: 44px; height: 44px; object-fit: cover; border-radius: 6px; background: #f8f9fa; }
				.search-island__item-content { flex: 1; display: flex; flex-direction: column; }
				.search-island__item-text { font-weight: 500; }
				.search-island__item-badge { display: inline-block; padding: 2px 6px; font-size: 0.7rem; font-weight: 600; color: #6c757d; background: #e9ecef; border-radius: 4px; margin-top: 2px; width: fit-content; }
				.search-island__item-price { font-size: 0.875rem; font-weight: 600; color: #2d6a4f; margin-top: 2px; }
				.search-island__item-icon { color: #6c757d; flex-shrink: 0; }
				.search-island__recent-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 16px; font-size: 0.75rem; font-weight: 600; color: #6c757d; text-transform: uppercase; border-bottom: 1px solid #f1f3f4; }
				.search-island__clear-btn { background: none; border: none; font-size: 0.75rem; color: #dc3545; cursor: pointer; text-transform: none; }
				.search-island__clear-btn:hover { text-decoration: underline; }
				.search-island__empty { padding: 24px 16px; text-align: center; color: #6c757d; }
				.search-highlight { background: #fff3cd; padding: 0 1px; border-radius: 2px; }
			`})]})},Y=({endpoint:g="/api/search/suggestions",searchPageUrl:u="/search",placeholder:m="Search products...",minChars:h=1,debounceMs:v=200,maxSuggestions:j=8,showImages:N=!0,showPrices:R=!0,fuzzyMatch:b=!0,autoFocus:k=!0})=>{const[i,D]=r.useState(""),[d,C]=r.useState([]),[a,E]=r.useState([]),[L,z]=r.useState(!1),[T,o]=r.useState(!1),[w,p]=r.useState(-1),[f,l]=r.useState("suggestions"),x=r.useRef(null),$=r.useRef(null),y=r.useRef(null),_=r.useRef(null);r.useEffect(()=>{try{const e=localStorage.getItem("recentSearches");e&&E(JSON.parse(e).slice(0,5))}catch{}},[]),r.useEffect(()=>{k&&x.current&&x.current.focus()},[k]);const A=r.useCallback(e=>{try{const s=[e,...a.filter(c=>c.toLowerCase()!==e.toLowerCase())].slice(0,5);E(s),localStorage.setItem("recentSearches",JSON.stringify(s))}catch{}},[a]),P=r.useCallback(async e=>{if(!e||e.length<h){C([]),l(a.length>0?"recent":"suggestions"),o(a.length>0);return}_.current&&_.current.abort(),_.current=new AbortController,z(!0),l("suggestions");try{const s=new URLSearchParams({q:e,limit:j.toString(),fuzzy:b?"true":"false"}),c=await fetch(`${g}?${s.toString()}`,{signal:_.current.signal});if(!c.ok)throw new Error("Search failed");const n=await c.json(),I=n!=null&&n.success?n.suggestions||[]:[];C(I),o(!0)}catch(s){s.name!=="AbortError"&&(console.error("Search error:",s),C([]),o(!0))}finally{z(!1)}},[g,h,j,b,a.length]),W=e=>{const s=e.target.value;D(s),p(-1),s?s.length>=h&&(o(!0),l("suggestions")):(o(a.length>0),l(a.length>0?"recent":"suggestions")),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>P(s),v)},B=e=>{const s=f==="suggestions"?d:a,c=s.length;if(!T&&e.key!=="Enter"){i.length===0&&a.length>0&&(o(!0),l("recent"));return}switch(e.key){case"ArrowDown":e.preventDefault(),p(n=>n<c-1?n+1:n);break;case"ArrowUp":e.preventDefault(),p(n=>n>0?n-1:-1);break;case"Tab":d.length>0&&a.length>0&&(e.preventDefault(),l(n=>n==="suggestions"?"recent":"suggestions"),p(-1));break;case"Enter":if(e.preventDefault(),w>=0&&w<c){const n=s[w];f==="suggestions"?U(n):F(n)}else O(e);break;case"Escape":o(!1),p(-1),x.current&&x.current.blur();break}},O=e=>{e.preventDefault()},U=e=>{e.type==="product"&&e.slug?(A(e.text),window.location.href=`/product/${e.slug}`):e.type==="category"&&e.slug?window.location.href=`/category/${e.slug}`:(A(e.text),window.location.href=`${u}?q=${encodeURIComponent(e.text)}`)},F=e=>{D(e),window.location.href=`${u}?q=${encodeURIComponent(e)}`},J=e=>{e.stopPropagation(),E([]);try{localStorage.removeItem("recentSearches")}catch{}},K=()=>{i.length>=h&&d.length>0?(o(!0),l("suggestions")):a.length>0&&(o(!0),l("recent"))};r.useEffect(()=>{const e=s=>{var c;$.current&&!$.current.contains(s.target)&&!((c=x.current)!=null&&c.contains(s.target))&&o(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),r.useEffect(()=>()=>{y.current&&clearTimeout(y.current),_.current&&_.current.abort()},[]),r.useEffect(()=>{d.length>0&&o(!0)},[d]);const H=(e,s)=>{if(!s||!b)return e;const c=new RegExp(`(${s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return e.split(c).map((n,I)=>c.test(n)?t.jsx("mark",{className:"search-highlight",children:n},I):n)},V=i.length>=h||a.length>0,q=T&&V;return t.jsx(t.Fragment,{children:t.jsx(X,{placeholder:m,value:i,onChange:W,onKeyDown:B,onFocus:K,onSubmit:O,inputRef:x,showSpinner:L,ariaExpanded:q,children:q&&t.jsxs("div",{ref:$,className:"search-island__dropdown",children:[d.length>0&&a.length>0&&t.jsxs("div",{className:"search-island__tabs",children:[t.jsx("button",{type:"button",className:`search-island__tab ${f==="suggestions"?"search-island__tab--active":""}`,onClick:()=>{l("suggestions"),p(-1)},children:"Suggestions"}),t.jsx("button",{type:"button",className:`search-island__tab ${f==="recent"?"search-island__tab--active":""}`,onClick:()=>{l("recent"),p(-1)},children:"Recent"})]}),f==="suggestions"&&d.length>0&&t.jsx("ul",{className:"search-island__list",children:d.map((e,s)=>t.jsxs("li",{className:`search-island__item ${s===w?"search-island__item--selected":""}`,onClick:()=>U(e),children:[N&&e.imageUrl&&t.jsx("img",{src:e.imageUrl,alt:"",className:"search-island__item-img"}),t.jsxs("div",{className:"search-island__item-content",children:[t.jsx("span",{className:"search-island__item-text",children:H(e.text,i)}),e.type==="category"&&t.jsx("span",{className:"search-island__item-badge",children:"Category"}),R&&e.price&&t.jsx("span",{className:"search-island__item-price",children:e.price})]})]},e.id||s))}),f==="recent"&&a.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"search-island__recent-header",children:[t.jsx("span",{children:"Recent Searches"}),t.jsx("button",{type:"button",className:"search-island__clear-btn",onClick:J,children:"Clear"})]}),t.jsx("ul",{className:"search-island__list",children:a.map((e,s)=>t.jsxs("li",{className:`search-island__item ${s===w?"search-island__item--selected":""}`,onClick:()=>F(e),children:[t.jsxs("svg",{className:"search-island__item-icon",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("polyline",{points:"12,6 12,12 16,14"})]}),t.jsx("span",{className:"search-island__item-text",children:e})]},e))})]}),f==="suggestions"&&i.length>=h&&d.length===0&&!L&&t.jsxs("div",{className:"search-island__empty",children:['No products found for "',i,'"']})]})})})};function ee(g,u){G.createRoot(g).render(t.jsx(Y,{...u}))}export{Y as default,ee as mount};
