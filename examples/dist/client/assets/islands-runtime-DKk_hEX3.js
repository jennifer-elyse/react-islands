import{R as g}from"./index-DYrVU9rO.js";import{c as h}from"./client-CKv3Qlnq.js";const v="/api/client-security-event",c=({event:e,detail:t={}})=>{const r=JSON.stringify({event:e,detail:t,path:window.location.pathname,timestamp:new Date().toISOString()});try{if(navigator.sendBeacon){const o=new Blob([r],{type:"application/json"});navigator.sendBeacon(v,o);return}fetch(v,{method:"POST",headers:{"Content-Type":"application/json"},body:r,keepalive:!0})}catch{}},w=async e=>{var i;if(!((i=window.crypto)!=null&&i.subtle)||typeof TextEncoder>"u")return null;const t=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",t),o=new Uint8Array(r);let a="";for(const n of o)a+=String.fromCharCode(n);return`sha256-${btoa(a)}`},b=async({elId:e="islands-manifest",integrityAttr:t="data-integrity",reportEvent:r})=>{const o=document.getElementById(e);if(!o)return{modules:{}};const a=o.textContent||"{}",i=o.getAttribute(t);if(i)try{const n=await w(a);n&&n!==i&&(console.error("Islands manifest integrity check failed."),c({event:"manifest_integrity_failed",detail:{expectedIntegrity:i,actualIntegrity:n}}),console.warn("Proceeding with manifest despite integrity mismatch (fail-open mode)."))}catch(n){console.error("Islands manifest integrity check errored. Proceeding in fail-open mode."),c({event:"manifest_integrity_error",detail:{message:(n==null?void 0:n.message)||String(n)}})}try{const n=JSON.parse(a);return n.modules||(n.modules={}),n}catch{return{modules:{}}}},I=e=>{let t=!1;return(...r)=>{t||(t=!0,e(...r))}},_=()=>{},E=e=>{if("requestIdleCallback"in window){window.requestIdleCallback(e,{timeout:2e3});return}setTimeout(e,250)},k=(e,t)=>{if(!("IntersectionObserver"in window)){t();return}const r=new IntersectionObserver(o=>{for(const a of o)if(a.isIntersecting){r.disconnect(),t();return}});r.observe(e)},S=(e,t)=>{const r=I(t),o=()=>{e.removeEventListener("click",o,!0),e.removeEventListener("focus",o,!0),e.removeEventListener("keydown",o,!0),r()};e.addEventListener("click",o,!0),e.addEventListener("focus",o,!0),e.addEventListener("keydown",o,!0)},C=async({el:e,moduleSpecifier:t,props:r,manifest:o})=>{const a=o.modules[t];if(!a){c({event:"island_module_missing",detail:{moduleSpecifier:t}});return}let i;try{i=await import(a)}catch(s){console.error("Island module import failed",{moduleSpecifier:t,resolved:a,err:s}),c({event:"island_import_failed",detail:{moduleSpecifier:t,resolved:a,message:(s==null?void 0:s.message)||String(s)}});return}const n=i.default;if(!n&&typeof i.mount=="function"){try{i.mount(e,r)}catch(s){console.error("Island mount() fallback failed",{moduleSpecifier:t,resolved:a,err:s}),c({event:"island_mount_failed",detail:{moduleSpecifier:t,resolved:a,message:(s==null?void 0:s.message)||String(s),mode:"mount-fallback"}})}return}if(!n){c({event:"island_default_export_missing",detail:{moduleSpecifier:t,resolved:a}});return}const d=e.childNodes&&e.childNodes.length>0;try{d?h.hydrateRoot(e,g.createElement(n,r)):h.createRoot(e).render(g.createElement(n,r))}catch(s){console.error("Island mount failed",{moduleSpecifier:t,resolved:a,err:s}),c({event:"island_mount_failed",detail:{moduleSpecifier:t,resolved:a,message:(s==null?void 0:s.message)||String(s)}})}},m=async({manifestElId:e="islands-manifest",selector:t="[data-island-module]",onError:r,reportEvent:o}={})=>{const a=typeof o=="function"?o:_,i=await b({elId:e,reportEvent:a}),n=document.querySelectorAll(t);n.length||c({event:"islands_not_found"});for(const d of n){const s=d.getAttribute("data-island-module"),u=d.getAttribute("data-hydrate")||"visible",p=d.getAttribute("data-props")||"null";let f=null;try{f=JSON.parse(p)}catch{f=null}const l=()=>{try{return C({el:d,moduleSpecifier:s,props:f,manifest:i,reportEvent:a})}catch(y){r?r(y,d,s):console.error("Failed to hydrate island",s,y)}};u==="immediate"?l():u==="idle"?E(l):u==="interaction"?S(d,l):k(d,l)}};typeof document<"u"?document.readyState==="loading"&&document.addEventListener("DOMContentLoaded",()=>{m()}):m();m();
